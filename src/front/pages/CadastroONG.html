<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Cadastro de ONG</title>
<style>
  body { font-family: Arial, sans-serif; margin: 20px; }
  input, button { margin: 5px; padding: 8px; }
</style>
</head>
<body>
<h1>Cadastro de ONG</h1>

<form id="formOng">
  <h3>Dados Pessoais</h3>
  <input type="text" id="nome" placeholder="Nome" required><br>
  <input type="text" id="telefone" placeholder="Telefone" required><br>
  <input type="email" id="email" placeholder="Email" required><br>
  <input type="password" id="senha" placeholder="Senha" required><br>

  <h3>Endereço</h3>
  <input type="text" id="nomeong" placeholder="NomedaONG" required><br>
  <input type="text" id="rua" placeholder="Rua" required><br>
  <input type="text" id="numero" placeholder="Número" required><br>
  <input type="text" id="bairro" placeholder="Bairro" required><br>
  <input type="text" id="cidade" placeholder="Cidade" required><br>
  <input type="text" id="estado" placeholder="Estado" required><br>
  <input type="text" id="cep" placeholder="CEP" required><br>

  <button type="submit">Cadastrar ONG</button>
</form>

<script>
const API_URL = "http://localhost:5000";

async function obterCoordenadas(endereco) {

    const url = `https://nominatim.openstreetmap.org/search?q=${encodeURIComponent(endereco)}&format=json&limit=1`;
    const res = await fetch(url, { headers: { 'User-Agent': 'CadastroONGApp' } });
    const data = await res.json();
    if (data.length > 0) {
        console.log("Coordenadas encontradas:", data[0].lat, data[0].lon);
        return {
            latitude: parseFloat(data[0].lat),
            longitude: parseFloat(data[0].lon)
        };
    } else {
        alert("Endereço não encontrado!");
        return null;
    }
}

document.getElementById("formOng").addEventListener("submit", async (e) => {
    e.preventDefault();

    const enderecoStr = `${document.getElementById("rua").value}, ${document.getElementById("numero").value}, ${document.getElementById("bairro").value}, ${document.getElementById("estado").value}, ${document.getElementById("cep").value}`;
    const coords = await obterCoordenadas(enderecoStr);
    if (!coords) return;

    const ong = {
        Nome: document.getElementById("nome").value,
        Telefone: document.getElementById("telefone").value,
        Email: document.getElementById("email").value,
        Senha: document.getElementById("senha").value,
        NomeDaOng: document.getElementById("nomeong").value,
        endereco: {
            Rua: document.getElementById("rua").value,
            Numero: document.getElementById("numero").value,
            Bairro: document.getElementById("bairro").value,
            Cidade: document.getElementById("cidade").value,
            Estado: document.getElementById("estado").value,
            Cep: document.getElementById("cep").value
        },
        Latitude: coords.latitude,
        Longitude: coords.longitude
    };

    const res = await fetch(`${API_URL}/CadastrarOng`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(ong)
    });

    const msg = await res.text();
    alert(msg);
    document.getElementById("formOng").reset();
});
</script>
</body>
</html>
