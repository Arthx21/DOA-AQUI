<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Cadastro de Roupas</title>
<style>
  .roupa { border: 1px solid #ccc; margin: 5px; padding: 10px; border-radius: 5px; }
  img { max-width: 150px; display: block; margin-top: 5px; }
</style>
</head>
<body>
<h1>Cadastro de Roupas</h1>

<form id="formRoupa">
  <input type="number" id="iddoador" placeholder="ID do Doador" required><br>
  <input type="text" id="tipo" placeholder="Tipo da roupa" required><br>
  <input type="text" id="tamanho" placeholder="Tamanho" required><br>
  <input type="text" id="cor" placeholder="Cor" required><br>
  <input type="text" id="genero" placeholder="Gênero" required><br>
  <textarea id="descricao" placeholder="Descrição"></textarea><br>
  <input type="file" id="foto" accept="image/*" required><br>
  <button type="submit">Enviar</button>
</form>

<h2>Lista de Roupas</h2>
<div id="listaRoupas"></div>

<script>
const API_URL = "http://localhost:5000"; // ou sua URL pública

// Função para enviar roupa
document.getElementById("formRoupa").addEventListener("submit", async (e) => {
    e.preventDefault();

    const file = document.getElementById("foto").files[0];
    const reader = new FileReader();

    reader.onload = async () => {
        const base64Image = reader.result.split(",")[1];

        const roupa = {
            Iddoador: parseInt(document.getElementById("iddoador").value),
            Tipo: document.getElementById("tipo").value,
            Tamanho: document.getElementById("tamanho").value,
            Cor: document.getElementById("cor").value,
            Genero: document.getElementById("genero").value,
            Descricao: document.getElementById("descricao").value,
            Foto: base64Image
        };

        const res = await fetch(`${API_URL}/CadastrarRoupa`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(roupa)
        });

        const msg = await res.text();
        alert(msg);
        getRoupas(); // recarrega lista
    };

    reader.readAsDataURL(file);
});

// Função para listar roupas
async function getRoupas() {
    const res = await fetch(`${API_URL}/ListarRoupa`);
    const data = await res.json();
    const lista = document.getElementById("listaRoupas");
    lista.innerHTML = "";

    data.forEach(r => {
        lista.innerHTML += `
            <div class="roupa">
                ID Roupa: ${r.idroupa}<br>
                ID Doador: ${r.iddoador}<br>
                Tipo: ${r.tipo}<br>
                Tamanho: ${r.tamanho}<br>
                Cor: ${r.cor}<br>
                Gênero: ${r.genero}<br>
                Descrição: ${r.descricao}<br>
                <img src="data:image/png;base64,${r.foto}" />
            </div>
        `;
    });
}

// Carrega lista ao iniciar
getRoupas();
</script>
</body>
</html>
